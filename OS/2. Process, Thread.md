# Process, Thread
======

## 프로그램

파일이 저장 장치에만 있고, 메모리엔 올라가지 않은 정적인 상태
즉, 아직 실행되지 않은 파일을 의미한다.


## 프로세스

운영체제로부터 자원을 할당 받은 작업의 단위
즉, 실행된 프로그램을 의미한다.

프로그램을 실행하면 운영체제 할당해준 메모리에 올라가고
운영체제로부터 시스템 자원을 할당받게 된다.

프로세스는 최소 1개의 쓰레드를 갖게 되며
한 프로세스가 다른 프로세스의 자원에 접근하려면 별도의 방식을
사용해야 함 (IPC, LPC 등)


### 멀티 프로세스

하나의 프로그램을 여러개의 프로세스로 구성하여 프로세스가 병렬적으로
작업을 수행하는 것

- [Context_Switching]
여러개의 프로세스를 돌아가면서 작업을 처리하는 과정을 뜻하는데
동작 중인 프로세스가 대기를 하면서 해당 프로세스의 상태를 보관하고
대기하고 있던 다음 프로세스가 동작하면서 이전 프로세스의 상태를
복구하는 작업을 말한다.

각각의 프로세스는 독립적이므로 안전성이 좋고 한 프로세스에 문제가
생겨도 다른 프로세스에 영향을 주지않는다. 하지만 작업량이 많아
Context Switcing이 잦을 경우 성능 저하가 발생 할 수있다.

프로세스는 독립적이기 때문에 동기화 작업이 필요하지 않고
IPC를 사용한 자원 교환이 이루어 진다. 또한 한 쓰레드에서 문제가
발생했을때 그 프로세스 전체에 영향을 끼칠수 있게 되지만
멀티 프로세스 방식은 독립적인 성격 때문에 문제 발생시 다른
프로세스에 영향이 덜 가게 된다.


## 쓰레드

프로세스 안에서 실행되는 여러 흐름 단위

쓰레드는 프로세스가 할당 받은 메모리 내에서 쓰레드끼리
코드, 데이터, 힙 영역을 공유하고 스택 영역은 별도로 관리한다.


### 멀티 쓰레드

한 프로세스 내에는 여러 쓰레드가 동시에 실행될 수 있고
이를 멀티 쓰레드라고 한다.

독립적인 프로세스에 비해 쓰레드는 프로세스 메모리의 코드/데이터/힙
을 [공유]하고 있으므로 Context Switching의 대한 비용이 감소하고
프로세스간의 통신보다 쓰레드 간의 통신의 [응답속도가_빠른] 장점이 있다.
하지만 쓰레드의 스케줄링은 운영체제가 관리하지 않기 때문에 쓰레드간의
[동기화_문제]를 고려해야하고 하나의 쓰레드에 문제가 생기면 모든 프로세스에
영향을 끼친다.


CPU의 최소 작업 단위는 쓰레드이다.
운영체제의 최소 작업 단위는 프로세스이다.


## 교착상태(Dead Lock)

프로세스가 자원을 얻지 못해서 다음 작업처리를 하지 못하는 상태,
시스템적으로 한정된 자원을 여러곳에서 사용하려할때 일어나는 현상으로
무한히 다음 자원을 기다리게되는 문제가 발생한다.

이하 4가지가 [모두] 성립했을때 교착상태가 일어난다.

- [상호배제]: 자원은 한 번에 한 프로세스만 사용할 수있다.
- [점유대기]: 최소 하나의 자원을 점유하면서 다른 자원을 추가적으로 기다린다.
- [비선점]: 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 빼앗을 수 없다.
- [순환대기]: 각 프로세스는 순환적으로 다음 프로세스가 요구하는 자원을 점유하고 있다.


### 교착상태 대처법

- [예방]: 교착상태 발생 조건 중 하나를 제거
  자원 낭비가 심할수 있음

  상호배제 => 여러 프로세스가 공유 자원 사용
  점유대기 => 프로세스 실행전 모든 자원 할당
  비선점 => 다른 프로세스가 다른 자원을 요구할 때 가진 자원 반납
  순환대기 => 자원에 고유번호 할당 후 순서대로 자원 요구

- [회피]: 교착 상태 발생시 피해가는 법
  
  대표적인 회피 기법으로는 은행원 알고리즘이 있다.
  운영체제는 안전상태를 유지할 수있는 요구만을 받아들이고 리스크가 있는
  사용자의 요구는 나중에 만족될 수 있을 때까지 거절하는 방법

- [탐지]: 자원 할당 그래프를 통해 교착 상태를 탐지
  자원 탐지 알고리즘에 대한 오버헤드 필요

- [회복]: 교착 상태를 일으킨 프로세스를 종료하거나 할당된 자원을 해제시켜
  교착상태를 회복시키는 방법

  교착 상태의 프로세스를 모두 중지하거나 교착 상태가 제거될 때 까지
  프로세스를 차례로 중지


## 경쟁상태(Race Condition)

프로세스가 동시에 데이터에 접근하거나 접근 순서를 달리 했을때 결과값이
달라질수 있는 현상을 말한다.
경쟁상태 발생시 원하는 결과를 보장할수 없고 자료의 일관성이 떨어진다.
경쟁상태는 [임계구역] 또는 [상호배제]로 대처할수 있다.

- [임계구역]: 각 프로세스에서 공유 데이터를 접근하는 코드부분으로 한 프로세스가
  임계구역을 수행할 때는 다른 프로세스가 접근하지 못하게 제한 해야한다.

- [상호배제]: 자원은 한 번에 한 프로세스만 사용할 수있다.


## 세마포어(Semaphore), 뮤텍스(Mutex)

병행 처리를 위한 프로세스 동기화 기법,
여러 프로세스나 쓰레드가 공유 자원에 접근하는 것을 제어하는 방법

- [세마포어]
  멀티 프로그래밍 환경에서 공유 자원에 대한 접근을 제한하는 방법이다.
  세마포어는 공유 자원에 일정 허용치만큼만 접근할수 있도록한다.
  허용치를 넘긴 이후에 요청들은 대기를 하게 된다.
  임계구역 수행 후 자원 반납을 알리고 다른 요청을 허용할 수 있도록 한다.

- [뮤텍스]
  자원에 접근하는 쓰레드를 한번에 하나로 제한하는 방법으로
  세마포어 자원 허용치가 1인 세마포어라고 볼수 있다.
  사용중에 온 요청은 정해놓은 알고리즘(ex. Quene)에 의해 대기하게 된다.
  상호배제(Mutual Exclusion)의 약자이다.
  뮤텍스 알고리즘으로는 데커, 피터슨, 제과점 알고리즘 등이 있다.

세마포어는 뮤텍스를 포함할 수 있다.
세마포어는 다른 프로세스가 해제할 수있지만
뮤텍스는 반드시 자원을 점유한 프로세스가 직접 자원을 반납하여야 한다.


## 사용자/커널 수준 쓰레드

- [사용자_수준]
  커널에 의존적이지 않고 사용자가 라이브러리를 활용하는 방식을
  사용자 레벨 쓰레드라고 한다. 사용자 영역 쓰레드에서 행동하기 때문에
  Context Switching이 없고 커널 쓰레드보다 오버헤드가 적다.
  하지만 시스템 전반에 걸친 스케줄링 우선순위를 지원하지 않고
  프로세스에 속한 쓰레드 중 하나라도 블록되면 전체가 블록된다.

- [커널_수준]
  스케줄링을 하는 주체가 커널일때 커널 레벨 쓰레드라고 한다.
  커널 쓰레드는 각 쓰레드를 개별적으로 관리할수 있고 멀티프로세서 환경에
  유리하다. 하지만 멀티 프로세서를 위한 Context Switching에 따른
  오버헤드를 고려해야하고 커널 모드와 사용자 모드의 전환이 빈번하게 이루어져
  성능 저하가 발생 할 수있다.


Reference :
https://wooono.tistory.com/522
https://gyoogle.dev/blog/computer-science/operating-system/Process%20vs%20Thread.html
https://gyoogle.dev/blog/interview/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C.html
https://wooody92.github.io/os/%EB%A9%80%ED%8B%B0-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EB%A9%80%ED%8B%B0-%EC%8A%A4%EB%A0%88%EB%93%9C/
https://gyoogle.dev/blog/computer-science/operating-system/DeadLock.html
https://gyoogle.dev/blog/computer-science/operating-system/Race%20Condition.html
https://jungeun960.tistory.com/118
https://velog.io/@conatuseus/OS-%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4%EC%99%80-%EB%AE%A4%ED%85%8D%EC%8A%A4
https://www.crocus.co.kr/m/1255  
https://www.youtube.com/watch?v=1grtWKqTn50